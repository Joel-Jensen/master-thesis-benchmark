SELECT COUNT(DISTINCT user_id) AS distinct_user_count FROM transactions_iceberg;
SELECT id, user_id, amount, type, country_code, created_at FROM transactions_iceberg WHERE country_code = 'SE' ORDER BY amount DESC LIMIT 10;
SELECT COUNT(*) AS transactions_above_average FROM transactions_iceberg WHERE amount > (SELECT AVG(amount) FROM transactions_iceberg);
SELECT user_id, COUNT(*) AS transaction_count, SUM(amount) AS total_amount FROM transactions_iceberg WHERE user_id IN (1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000) GROUP BY user_id ORDER BY transaction_count DESC;
SELECT type, COUNT(*) AS transaction_count, SUM(amount) AS total_amount FROM transactions_iceberg GROUP BY type ORDER BY transaction_count DESC;
SELECT user_id, COUNT(*) AS transaction_count, SUM(amount) AS total_amount, AVG(amount) AS average_amount FROM transactions_iceberg t JOIN users_iceberg u ON t.user_id = u.id WHERE u.is_active = true GROUP BY user_id ORDER BY total_amount DESC LIMIT 10;
SELECT EXTRACT(HOUR FROM created_at) AS transaction_hour, type, COUNT(*) AS transaction_count FROM transactions_iceberg GROUP BY EXTRACT(HOUR FROM created_at), type ORDER BY transaction_hour, transaction_count DESC LIMIT 5;
WITH UserTotals AS ( SELECT user_id, SUM(amount) AS total_amount FROM transactions_iceberg GROUP BY user_id ), Top10Users AS ( SELECT user_id FROM ( SELECT user_id, RANK() OVER (ORDER BY total_amount DESC) AS rnk FROM UserTotals ) ranked WHERE rnk <= 10 ), UserTransactions AS ( SELECT t.user_id, t.id, t.amount, ROW_NUMBER() OVER (PARTITION BY t.user_id ORDER BY t.amount DESC) AS txn_rank FROM transactions_iceberg t JOIN Top10Users u ON t.user_id = u.user_id ) SELECT user_id, id, amount FROM UserTransactions WHERE txn_rank <= 10 ORDER BY user_id, amount DESC;
