SELECT COUNT(DISTINCT user_id) AS distinct_user_count FROM transactions WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01';
SELECT id, user_id, amount, type, country_code, created_at FROM transactions WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01' ORDER BY amount DESC LIMIT 10;
SELECT COUNT(*) AS transactions_above_average FROM transactions WHERE amount > (SELECT AVG(amount) FROM transactions) AND created_at >= '2024-01-01' AND created_at < '2025-01-01';
SELECT user_id, COUNT(*) AS transaction_count, SUM(amount) AS total_amount FROM transactions WHERE user_id IN (1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000) AND created_at >= '2024-01-01' AND created_at < '2025-01-01' GROUP BY user_id ORDER BY transaction_count DESC;
SELECT type, COUNT(*) AS transaction_count, SUM(amount) AS total_amount FROM transactions WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01' GROUP BY type ORDER BY transaction_count DESC;
SELECT user_id, COUNT(*) AS transaction_count, SUM(amount) AS total_amount, AVG(amount) AS average_amount FROM transactions WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01' GROUP BY user_id ORDER BY total_amount DESC LIMIT 10;
SELECT EXTRACT(HOUR FROM created_at) AS transaction_hour, type, COUNT(*) AS transaction_count FROM transactions WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01' GROUP BY EXTRACT(HOUR FROM created_at), type ORDER BY transaction_hour, transaction_count DESC LIMIT 5;
WITH user_summary AS ( SELECT user_id, COUNT(*) AS transaction_count, COUNT(DISTINCT DATE(created_at)) AS daily_count, COUNT(DISTINCT DATE_TRUNC('week', created_at)) AS weekly_count, COUNT(DISTINCT DATE_TRUNC('month', created_at)) AS monthly_count, COUNT(DISTINCT DATE_TRUNC('quarter', created_at)) AS quarterly_count, COUNT(DISTINCT DATE_TRUNC('year', created_at)) AS yearly_count FROM transactions WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01' GROUP BY user_id ), user_totals AS ( SELECT COUNT(*) AS total_users FROM user_summary ) SELECT (SELECT COUNT(*) FROM user_summary WHERE transaction_count = 0) / (SELECT total_users FROM user_totals) * 100 AS zero_transactions_percentage, (SELECT COUNT(*) FROM user_summary WHERE daily_count >= 1) / (SELECT total_users FROM user_totals) * 100 AS daily_users_percentage, (SELECT COUNT(*) FROM user_summary WHERE weekly_count >= 1) / (SELECT total_users FROM user_totals) * 100 AS weekly_users_percentage, (SELECT COUNT(*) FROM user_summary WHERE monthly_count >= 1) / (SELECT total_users FROM user_totals) * 100 AS monthly_users_percentage, (SELECT COUNT(*) FROM user_summary WHERE quarterly_count >= 1) / (SELECT total_users FROM user_totals) * 100 AS quarterly_users_percentage, (SELECT COUNT(*) FROM user_summary WHERE yearly_count >= 1) / (SELECT total_users FROM user_totals) * 100 AS yearly_users_percentage;
WITH RankedUsers AS ( SELECT user_id, SUM(amount) AS total_amount, RANK() OVER (ORDER BY SUM(amount) DESC) AS user_rank FROM transactions WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01' GROUP BY user_id ), Top10Users AS ( SELECT user_id FROM RankedUsers WHERE user_rank <= 10 ), RankedTransactions AS ( SELECT t.user_id, t.id, t.amount, ROW_NUMBER() OVER (PARTITION BY t.user_id ORDER BY t.amount DESC) AS transaction_rank FROM transactions t JOIN Top10Users u ON t.user_id = u.user_id WHERE t.created_at >= '2024-01-01' AND t.created_at < '2025-01-01') SELECT user_id, id, amount FROM RankedTransactions WHERE transaction_rank <= 10 ORDER BY user_id, amount DESC;
